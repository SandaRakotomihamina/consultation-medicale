<!DOCTYPE html>
<html data-theme="light">
    <head>
        <meta charset="UTF-8">
        <title>{% block title %}Welcome!{% endblock %}</title>
        <link rel="icon" type="image/png" href="{{ asset('images/logo.png') }}">
        <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
        {% block stylesheets %}
            <style>
                .flash { 
                    padding: .75rem 1rem; 
                    margin: .75rem auto; 
                    border-radius: 6px; 
                    box-sizing: border-box; 
                    transition: background 0.3s ease, color 0.3s ease, border-color 0.3s ease;
                }
                .flash-success { 
                    background: var(--success-bg); 
                    color: var(--success-text); 
                    border: 1px solid var(--success-border); 
                }
                .flash-error, .flash-danger { 
                    background: var(--error-bg-flash); 
                    color: var(--error-text-flash); 
                    border: 1px solid var(--error-border-flash); 
                }
                .flash-info { 
                    background: var(--info-bg); 
                    color: var(--info-text); 
                    border: 1px solid var(--info-border); 
                }

                #loading-overlay{
                    display: none; 
                    position: fixed; 
                    top: 0; 
                    left: 0; 
                    width: 100%; 
                    height: 100%; 
                    background: var(--loading-overlay); 
                    backdrop-filter: blur(4px);
                    z-index: 9999; 
                    display: flex; 
                    justify-content: center; 
                    align-items: center;
                    transition: background 0.3s ease;
                }
            </style>
        {% endblock %}

        {% block javascripts %}
            <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
            {% block importmap %}{{ importmap('app') }}{% endblock %}
            <script>
                // Initialiser le thème avant le chargement complet pour éviter le flash
                (function() {
                    const savedTheme = localStorage.getItem('theme');
                    const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    const theme = savedTheme || (systemPrefersDark ? 'dark' : 'light');
                    document.documentElement.setAttribute('data-theme', theme);
                })();
            </script>
        {% endblock %}
    </head>
    <body>
        <!-- Loading Animation -->
        <div id="loading-overlay" data-controller="loading">
            {% include '_partial/animations/loading.html.twig' %}
        </div>

        <!-- Scroll to Top Button -->
        <button 
            class="scroll-to-top-btn"
            data-controller="scroll-to-top" 
            data-scroll-to-top-target="button" 
            data-action="scroll-to-top#scrollToTop" 
            title="Retour en haut"
        >
        <svg class="svgIcon" viewBox="0 0 384 512">
            <path
            d="M214.6 41.4c-12.5-12.5-32.8-12.5-45.3 0l-160 160c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 141.2V448c0 17.7 14.3 32 32 32s32-14.3 32-32V141.2L329.4 246.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-160-160z"
            ></path>
        </svg>
        </button>


        {% block body %}{% endblock %}
        <script>
            (function () {
                if (window.__subnavInit) return;
                window.__subnavInit = true;

                function closeAll() {
                    document.querySelectorAll('.subnav-dropdown.open').forEach(function (d) {
                        d.classList.remove('open');
                        d.setAttribute('aria-hidden', 'true');
                    });
                    document.querySelectorAll('.hamburger-menu.open').forEach(function (b) {
                        b.classList.remove('open');
                        b.setAttribute('aria-expanded', 'false');
                    });
                }

                document.addEventListener('click', function (e) {
                    var burger = e.target.closest && e.target.closest('.hamburger-menu');
                    if (burger) {
                        e.stopPropagation();
                        var subnav = burger.closest && burger.closest('.subnav');
                        var dropdown = subnav && subnav.querySelector('.subnav-dropdown');
                        if (!dropdown) return;

                        if (dropdown.classList.contains('open')) {
                            dropdown.classList.remove('open');
                            dropdown.setAttribute('aria-hidden', 'true');
                            burger.classList.remove('open');      
                            burger.setAttribute('aria-expanded', 'false');
                        } else {
                            closeAll();
                            dropdown.classList.add('open');
                            dropdown.setAttribute('aria-hidden', 'false');
                            burger.classList.add('open');         
                            burger.setAttribute('aria-expanded', 'true');
                        }
                        return;
                    }

                    if (!e.target.closest || !e.target.closest('.subnav-dropdown')) {
                        closeAll();
                    }
                }, true);

                document.addEventListener('keydown', function (e) {
                    if (e.key === 'Escape' || e.key === 'Esc') {
                        closeAll();
                        return;
                    }
                    if (e.key === 'Enter' || e.key === ' ') {
                        var focused = document.activeElement;
                        if (focused && focused.classList && focused.classList.contains('hamburger-menu')) {
                            e.preventDefault();
                            focused.click();
                        }
                    }
                });
            })();
        </script>
    </body>
</html>
