<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>{% block title %}Welcome!{% endblock %}</title>
        <link rel="icon" type="image/png" href="{{ asset('images/logo.png') }}">
        {% block stylesheets %}
            <style>
                .flash { 
                    padding: .75rem 1rem; 
                    margin: .75rem auto; 
                    border-radius: 6px; 
                    box-sizing: border-box; 
                }
                .flash-success { 
                    background: #d4edda; 
                    color: #155724; 
                    border: 1px solid #c3e6cb; 
                }
                .flash-error, .flash-danger { 
                    background: #f8d7da; 
                    color: #721c24; 
                    border: 1px solid #f5c6cb; 
                }
                .flash-info { 
                    background: #d1ecf1; 
                    color: #0c5460; 
                    border: 1px solid #bee5eb; 
                }
            </style>
        {% endblock %}

        {% block javascripts %}
            {% block importmap %}{{ importmap('app') }}{% endblock %}
        {% endblock %}
    </head>
    <body>
        {% block body %}{% endblock %}
        {# Global subnav dropdown handler (delegated, idempotent). Placed in base so it survives Turbo/partial navigation #}
        <script>
        (function () {
            if (window.__subnavInit) return;
            window.__subnavInit = true;

            function closeAll() {
                document.querySelectorAll('.subnav-dropdown.open').forEach(function (d) {
                    d.classList.remove('open');
                    d.setAttribute('aria-hidden', 'true');
                });
                document.querySelectorAll('.hamburger-menu[aria-expanded="true"]').forEach(function (b) {
                    b.setAttribute('aria-expanded', 'false');
                });
            }

            document.addEventListener('click', function (e) {
                var burger = e.target.closest && e.target.closest('.hamburger-menu');
                if (burger) {
                    e.stopPropagation();
                    var subnav = burger.closest && burger.closest('.subnav');
                    var dropdown = subnav && subnav.querySelector('.subnav-dropdown');
                    if (!dropdown) return;
                    if (dropdown.classList.contains('open')) {
                        dropdown.classList.remove('open');
                        dropdown.setAttribute('aria-hidden', 'true');
                        burger.setAttribute('aria-expanded', 'false');
                    } else {
                        closeAll();
                        dropdown.classList.add('open');
                        dropdown.setAttribute('aria-hidden', 'false');
                        burger.setAttribute('aria-expanded', 'true');
                    }
                    return;
                }

                // click outside -> close all
                if (!e.target.closest || !e.target.closest('.subnav-dropdown')) {
                    closeAll();
                }
            }, true);

            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape' || e.key === 'Esc') {
                    closeAll();
                    return;
                }
                if (e.key === 'Enter' || e.key === ' ') {
                    var focused = document.activeElement;
                    if (focused && focused.classList && focused.classList.contains('hamburger-menu')) {
                        e.preventDefault();
                        focused.click();
                    }
                }
            });
        })();
        

        document.addEventListener('DOMContentLoaded', () => {

            const checkbox = document.getElementById('repos-check');

            // On cible automatiquement le <select> dans repos-field
            const reposInput = document.querySelector('#repos-field select');

            function toggle() {
                reposInput.disabled = !checkbox.checked;

                if (!checkbox.checked) {
                    reposInput.value = "";
                }
            }

            checkbox.addEventListener('change', toggle);
            toggle(); // Ã©tat initial
        });
        </script>
    </body>
</html>
